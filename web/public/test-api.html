<!DOCTYPE html>
<html>
<head>
    <title>API æµ‹è¯• - Crypto Attention Lab</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #0a0a0a; color: #fff; }
        .section { margin: 20px 0; padding: 15px; background: #1a1a1a; border: 1px solid #333; }
        .success { color: #0f0; }
        .error { color: #f00; }
        pre { background: #000; padding: 10px; overflow: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” API æµ‹è¯•é¢æ¿</h1>
    
    <div class="section">
        <h2>1. æµ‹è¯•ä»·æ ¼ API</h2>
        <button onclick="testPrice()">æµ‹è¯• /api/price</button>
        <div id="price-result"></div>
    </div>
    
    <div class="section">
        <h2>2. æµ‹è¯•æ³¨æ„åŠ› API</h2>
        <button onclick="testAttention()">æµ‹è¯• /api/attention</button>
        <div id="attention-result"></div>
    </div>
    
    <div class="section">
        <h2>3. æµ‹è¯•æ–°é—» API</h2>
        <button onclick="testNews()">æµ‹è¯• /api/news</button>
        <div id="news-result"></div>
    </div>
    
    <div class="section">
        <h2>4. æµ‹è¯•ç»Ÿè®¡è®¡ç®—</h2>
        <button onclick="testSummaryStats()">æµ‹è¯•ç»Ÿè®¡è®¡ç®—</button>
        <div id="stats-result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        async function testPrice() {
            const el = document.getElementById('price-result');
            el.innerHTML = '<p>â³ åŠ è½½ä¸­...</p>';
            try {
                const resp = await fetch(`${API_BASE}/api/price?symbol=ZECUSDT&timeframe=1d`);
                const data = await resp.json();
                el.innerHTML = `
                    <p class="success">âœ… æˆåŠŸ! è·å– ${data.length} ä¸ªæ•°æ®ç‚¹</p>
                    <pre>${JSON.stringify(data.slice(-3), null, 2)}</pre>
                `;
            } catch (err) {
                el.innerHTML = `<p class="error">âŒ é”™è¯¯: ${err.message}</p>`;
            }
        }
        
        async function testAttention() {
            const el = document.getElementById('attention-result');
            el.innerHTML = '<p>â³ åŠ è½½ä¸­...</p>';
            try {
                const resp = await fetch(`${API_BASE}/api/attention?symbol=ZEC`);
                const data = await resp.json();
                el.innerHTML = `
                    <p class="success">âœ… æˆåŠŸ! è·å– ${data.length} ä¸ªæ•°æ®ç‚¹</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                el.innerHTML = `<p class="error">âŒ é”™è¯¯: ${err.message}</p>`;
            }
        }
        
        async function testNews() {
            const el = document.getElementById('news-result');
            el.innerHTML = '<p>â³ åŠ è½½ä¸­...</p>';
            try {
                const resp = await fetch(`${API_BASE}/api/news?symbol=ZEC`);
                const data = await resp.json();
                el.innerHTML = `
                    <p class="success">âœ… æˆåŠŸ! è·å– ${data.length} æ¡æ–°é—»</p>
                    <pre>${JSON.stringify(data.slice(0, 3), null, 2)}</pre>
                `;
            } catch (err) {
                el.innerHTML = `<p class="error">âŒ é”™è¯¯: ${err.message}</p>`;
            }
        }
        
        async function testSummaryStats() {
            const el = document.getElementById('stats-result');
            el.innerHTML = '<p>â³ è®¡ç®—ä¸­...</p>';
            try {
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString();
                const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();
                
                const [priceData, attentionData, newsData] = await Promise.all([
                    fetch(`${API_BASE}/api/price?symbol=ZECUSDT&timeframe=1d`).then(r => r.json()),
                    fetch(`${API_BASE}/api/attention?symbol=ZEC&start=${weekAgo}`).then(r => r.json()),
                    fetch(`${API_BASE}/api/news?symbol=ZEC&start=${yesterday}`).then(r => r.json()),
                ]);
                
                const latestPrice = priceData[priceData.length - 1];
                const previousPrice = priceData[priceData.length - 2];
                
                const stats = {
                    current_price: latestPrice?.close || 0,
                    previous_price: previousPrice?.close || 0,
                    price_change_24h: previousPrice ? ((latestPrice.close - previousPrice.close) / previousPrice.close * 100) : 0,
                    volume_24h: latestPrice?.volume || 0,
                    current_attention: attentionData[attentionData.length - 1]?.attention_score || 0,
                    avg_attention_7d: attentionData.reduce((sum, d) => sum + d.attention_score, 0) / attentionData.length,
                    news_count_today: newsData.length,
                    
                    debug: {
                        priceDataPoints: priceData.length,
                        attentionDataPoints: attentionData.length,
                        newsDataPoints: newsData.length,
                    }
                };
                
                el.innerHTML = `
                    <p class="success">âœ… è®¡ç®—æˆåŠŸ!</p>
                    <pre>${JSON.stringify(stats, null, 2)}</pre>
                `;
            } catch (err) {
                el.innerHTML = `<p class="error">âŒ é”™è¯¯: ${err.message}</p>`;
            }
        }
        
        // è‡ªåŠ¨æµ‹è¯•
        window.onload = () => {
            console.log('ğŸš€ è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            testPrice();
            setTimeout(testAttention, 500);
            setTimeout(testNews, 1000);
            setTimeout(testSummaryStats, 1500);
        };
    </script>
</body>
</html>
