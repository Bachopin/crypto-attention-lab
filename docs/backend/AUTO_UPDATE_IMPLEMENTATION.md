# è‡ªåŠ¨æ›´æ–°æœºåˆ¶ - å®æ–½æ€»ç»“

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1. **æ–°å¢ä»£å¸ç«‹å³åˆå§‹åŒ–**
**æ–‡ä»¶**: `src/api/main.py` - `enable_auto_update` ç«¯ç‚¹

**æ”¹è¿›å‰**:
- ä»…æ›´æ–°æ•°æ®åº“æ ‡è®° `auto_update_price=True`
- éœ€è¦ç­‰å¾…å®šæ—¶ä»»åŠ¡è§¦å‘ï¼ˆ2åˆ†é’Ÿ + 1å°æ—¶ï¼‰

**æ”¹è¿›å**:
```python
@app.post("/api/auto-update/enable")
async def enable_auto_update(payload):
    # 1. æ›´æ–°æ•°æ®åº“æ ‡è®°
    # 2. æ£€æŸ¥ä»·æ ¼æ•°æ®æ˜¯å¦å­˜åœ¨/è¿‡æ—§
    # 3. å¦‚éœ€è¦ï¼Œç«‹å³æ‹‰å–â‰¥1å¹´å†å²ä»·æ ¼
    # 4. ç«‹å³è®¡ç®— Attention Features
    return {"initialized": [...]}
```

**æ•ˆæœ**: ç”¨æˆ·ç‚¹å‡»"å¯ç”¨"åï¼Œç«‹å³å®Œæˆæ•°æ®åˆå§‹åŒ–ï¼Œæ— éœ€ç­‰å¾…

---

### 2. **ä»·æ ¼æ›´æ–°åç«‹å³è®¡ç®— Attention**
**æ–‡ä»¶**: `src/data/realtime_price_updater.py` - `update_all_symbols` æ–¹æ³•

**æ”¹è¿›å‰**:
- ä»·æ ¼æ›´æ–°ï¼ˆæ¯2åˆ†é’Ÿï¼‰å’Œ Attention è®¡ç®—ï¼ˆæ¯1å°æ—¶ï¼‰æ˜¯ç‹¬ç«‹çš„å®šæ—¶ä»»åŠ¡
- å¯èƒ½å‡ºç°ä»·æ ¼å·²æ›´æ–°ä½† Attention æœªè®¡ç®—çš„æƒ…å†µ

**æ”¹è¿›å**:
```python
async def update_all_symbols(self):
    for symbol in enabled_symbols:
        # 1. æ›´æ–°ä»·æ ¼æ•°æ®
        await self.update_single_symbol(symbol)
        
        # 2. ç«‹å³è®¡ç®— Attention Features
        await asyncio.to_thread(
            process_attention_features, 
            symbol, 
            freq='D', 
            save_to_db=True
        )
```

**æ•ˆæœ**: ç¡®ä¿ Attention æ•°æ®å§‹ç»ˆåŸºäºæœ€æ–°ä»·æ ¼ï¼Œé¿å…ä¸åŒæ­¥

---

### 3. **ç§»é™¤ç‹¬ç«‹çš„ Attention å®šæ—¶ä»»åŠ¡**
**æ–‡ä»¶**: `src/api/main.py` - `lifespan` å‡½æ•°

**æ”¹è¿›å‰**:
- 3ä¸ªåå°ä»»åŠ¡: `news_task`, `price_task`, `attention_task`
- Attention æ¯1å°æ—¶ç‹¬ç«‹è¿è¡Œ

**æ”¹è¿›å**:
- 2ä¸ªåå°ä»»åŠ¡: `news_task`, `price_task`
- Attention ç”± `price_task` è§¦å‘ï¼Œæ— éœ€ç‹¬ç«‹ä»»åŠ¡

**æ•ˆæœ**: ç®€åŒ–æ¶æ„ï¼Œå‡å°‘èµ„æºæ¶ˆè€—ï¼Œé¿å…é‡å¤è®¡ç®—

---

### 4. **ç§»é™¤ä»£å¸åŠŸèƒ½**
**æ–‡ä»¶**: `src/api/main.py` - `disable_auto_update` ç«¯ç‚¹

**æ”¹è¿›å‰**:
- æ— æ³•é€šè¿‡ API ç§»é™¤ä»£å¸ï¼Œåªèƒ½æ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“

**æ”¹è¿›å**:
```python
@app.post("/api/auto-update/remove")
async def disable_auto_update(payload):
    # 1. æ›´æ–°æ•°æ®åº“æ ‡è®° auto_update_price=False
    # 2. æ›´æ–°æ•°æ®åº“æ ‡è®° is_active=False
    return {"removed": [...]}
```

**æ•ˆæœ**: ç”¨æˆ·å¯éšæ—¶åœæ­¢è·Ÿè¸ªä»£å¸ï¼Œä¿ç•™å†å²æ•°æ®ä½†åœæ­¢åå°æ›´æ–°

---

## ğŸ“Š **æ›´æ–°åçš„æ•°æ®æµ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯æ“ä½œ: å¯ç”¨ BTC è‡ªåŠ¨æ›´æ–°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auto-update/enable                        â”‚
â”‚  âœ… æ›´æ–°æ•°æ®åº“æ ‡è®°                                   â”‚
â”‚  âœ… æ‹‰å–500å¤©å†å²ä»·æ ¼ (æˆ–åˆ°ä¸Šçº¿æ—¥æœŸ)                  â”‚
â”‚  âœ… è®¡ç®— Attention Features                         â”‚
â”‚     - News: æ•°æ®åº“æŸ¥è¯¢                              â”‚
â”‚     - Google Trends: API è·å–                       â”‚
â”‚     - Twitter: å ä½ 0                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åå°å®šæ—¶ä»»åŠ¡                                         â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ News (1å°æ—¶)    â”‚  â”‚ Price (2åˆ†é’Ÿ)            â”‚ â”‚
â”‚ â”‚ - æ‹‰å–å…¨å±€æ–°é—»   â”‚  â”‚ - å¢é‡æ›´æ–°ä»·æ ¼           â”‚ â”‚
â”‚ â”‚ - å­˜å…¥æ•°æ®åº“     â”‚  â”‚ - âœ… ç«‹å³è®¡ç®— Attention â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ **æ ¸å¿ƒè®¾è®¡åŸåˆ™**

### âœ… **è¢«åŠ¨æ•°æ®è·å–**
- Google Trends å’Œ Twitter æ•°æ®**ä¸éœ€è¦**ç‹¬ç«‹çš„å®šæ—¶ä»»åŠ¡
- ç”± `process_attention_features()` æŒ‰éœ€è‡ªåŠ¨è·å–
- ç¡®ä¿æ•°æ®èŒƒå›´ä¸ä»·æ ¼æ•°æ®å®Œå…¨å¯¹é½

### âœ… **æ–°é—»æ•°æ®æ± åŒ–**
- æ–°é—»æ•°æ®å…¨å±€æ‹‰å–ï¼Œä¸åŒºåˆ†ä»£å¸
- å­˜å‚¨åœ¨ç»Ÿä¸€æ•°æ®åº“ä¸­ï¼Œå¸¦ `symbols` æ ‡è¯†
- æ–°å¢ä»£å¸å¯åˆ©ç”¨å†å²æ–°é—»æ•°æ®

### âœ… **ä»·æ ¼é©±åŠ¨æ›´æ–°**
- Attention æ›´æ–°ç´§è·Ÿä»·æ ¼æ›´æ–°
- é¿å…ä»·æ ¼å’Œç‰¹å¾æ•°æ®ä¸åŒæ­¥
- 2åˆ†é’Ÿæ›´æ–°å‘¨æœŸï¼Œä¿æŒæ•°æ®æ–°é²œåº¦

---

## ğŸ“ **ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•**

1. **`src/api/main.py`**
   - âœ… ä¿®æ”¹ `enable_auto_update`: æ·»åŠ ç«‹å³åˆå§‹åŒ–é€»è¾‘
   - âœ… ç§»é™¤ `scheduled_attention_update` å‡½æ•°
   - âœ… æ›´æ–° `lifespan`: ç§»é™¤ attention_task

2. **`src/data/realtime_price_updater.py`**
   - âœ… ä¿®æ”¹ `update_all_symbols`: ä»·æ ¼æ›´æ–°åç«‹å³è®¡ç®— Attention

3. **`AUTO_UPDATE_MECHANISM.md`** (æ–°å»º)
   - ğŸ“„ å®Œæ•´çš„æœºåˆ¶è¯´æ˜æ–‡æ¡£

4. **`scripts/test_auto_update_flow.py`** (æ–°å»º)
   - ğŸ§ª æµ‹è¯•è„šæœ¬ï¼ŒéªŒè¯æ•´ä¸ªæµç¨‹

---

## ğŸ§ª **æµ‹è¯•æ–¹æ³•**

### 1. æµ‹è¯•æ–°å¢ä»£å¸åˆå§‹åŒ–
```bash
cd /workspaces/crypto-attention-lab
python3 scripts/test_auto_update_flow.py --mode enable --symbol DOGE
```

**é¢„æœŸè¾“å‡º**:
```
âœ… åˆ›å»ºæ–°æ ‡çš„: DOGE
âœ… ä»·æ ¼æ•°æ®æ‹‰å–å®Œæˆ
âœ… Attention Features è®¡ç®—å®Œæˆ: 500 æ¡è®°å½•
âœ… æ•°æ®åº“éªŒè¯æˆåŠŸ: 500 æ¡ Attention è®°å½•
```

### 2. æµ‹è¯•å®šæ—¶æ›´æ–°æµç¨‹
```bash
python3 scripts/test_auto_update_flow.py --mode update
```

**é¢„æœŸè¾“å‡º**:
```
âœ… BTC ä»·æ ¼æ›´æ–°å®Œæˆ
âœ… BTC Attention æ›´æ–°å®Œæˆ
```

### 3. å‰ç«¯æµ‹è¯•
1. å¯åŠ¨åç«¯: `bash scripts/start_api.sh`
2. å¯åŠ¨å‰ç«¯: `cd web && npm run dev`
3. è®¿é—® `http://localhost:3000`
4. åœ¨"å®æ—¶ä»·æ ¼è·Ÿè¸ªç®¡ç†"ä¸­å¯ç”¨æ–°ä»£å¸
5. è§‚å¯Ÿåç«¯æ—¥å¿—ï¼Œç¡®è®¤ç«‹å³åˆå§‹åŒ–

---

## ğŸ“Œ **é‡è¦æç¤º**

### âš ï¸ Google Trends API é™åˆ¶
- å¯èƒ½é‡åˆ° 429 é€Ÿç‡é™åˆ¶
- ç³»ç»Ÿä¼šé™çº§å¤„ç†ï¼ˆå¡«å……0ï¼‰ï¼Œä¸å½±å“æ•´ä½“æµç¨‹
- å»ºè®®æ·»åŠ ä»£ç†æˆ–å»¶è¿Ÿç­–ç•¥

### âš ï¸ å…¨é‡é‡æ–°è®¡ç®—
- å½“å‰æ¯æ¬¡éƒ½å®Œæ•´è®¡ç®—æ‰€æœ‰å†å²æ•°æ®
- å¯¹äº500å¤©æ•°æ®ï¼Œå¯èƒ½éœ€è¦1-2åˆ†é’Ÿ
- æœªæ¥å¯ä¼˜åŒ–ä¸ºå¢é‡æ¨¡å¼

### âš ï¸ Twitter æ•°æ®å¾…å®ç°
- å½“å‰ä¸ºå ä½å€¼ 0
- é€»è¾‘æ¡†æ¶å·²é¢„ç•™ï¼Œæ— éœ€æ”¹åŠ¨æ•´ä½“æ¶æ„
- é›†æˆ Twitter API åå¯ç›´æ¥ä½¿ç”¨

---

## âœ¨ **ç”¨æˆ·ä½“éªŒæ”¹è¿›**

### æ”¹è¿›å‰
1. å¯ç”¨æ–°ä»£å¸ â†’ ç­‰å¾…2åˆ†é’Ÿä»·æ ¼æ›´æ–° â†’ ç­‰å¾…1å°æ—¶ Attention è®¡ç®—
2. æ€»ç­‰å¾…æ—¶é—´: **æœ€é•¿62åˆ†é’Ÿ**

### æ”¹è¿›å
1. å¯ç”¨æ–°ä»£å¸ â†’ ç«‹å³æ‹‰å–ä»·æ ¼ â†’ ç«‹å³è®¡ç®— Attention
2. æ€»ç­‰å¾…æ—¶é—´: **çº¦1-2åˆ†é’Ÿ**ï¼ˆå–å†³äºæ•°æ®é‡ï¼‰

**æ•ˆç‡æå‡**: ~30å€ ğŸš€

---

**å®æ–½å®Œæˆæ—¥æœŸ**: 2025-11-30  
**ç‰ˆæœ¬**: v2.1  
**çŠ¶æ€**: âœ… å·²éƒ¨ç½²ï¼Œå¯æµ‹è¯•

````
