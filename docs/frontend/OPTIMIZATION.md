# å‰ç«¯ä¼˜åŒ–å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. æ¶ˆé™¤å›¾è¡¨åˆ‡æ¢é—ªçƒï¼ˆæ—¶é—´å‘¨æœŸåˆ‡æ¢ï¼‰

#### é—®é¢˜
ä¹‹å‰åˆ‡æ¢ 1D/4H/1H/15M æ—¶é—´å‘¨æœŸæ—¶ï¼Œé¡µé¢ä¼šæ˜¾ç¤º "Loading data..." åŠ¨ç”»ï¼Œä½“éªŒä¸æµç•…

#### è§£å†³æ–¹æ¡ˆ
- **åˆ†ç¦»æ•°æ®åŠ è½½é€»è¾‘**ï¼š
  - `loadData(showLoading)`: å®Œæ•´æ•°æ®åŠ è½½ï¼Œæ”¯æŒå¯é€‰çš„ loading åŠ¨ç”»
  - `updatePriceOnly()`: ä»…æ›´æ–°ä»·æ ¼æ•°æ®ï¼Œæ—  loading åŠ¨ç”»
  
- **åˆ†ç¦» useEffect ä¾èµ–**ï¼š
  - æ ‡çš„åˆ‡æ¢ï¼ˆ`selectedSymbol`ï¼‰â†’ è§¦å‘ `loadData(true)` æ˜¾ç¤º loading
  - æ—¶é—´å‘¨æœŸåˆ‡æ¢ï¼ˆ`selectedTimeframe`ï¼‰â†’ è§¦å‘ `updatePriceOnly()` æ— æ„Ÿæ›´æ–°

#### ä»£ç å®ç°
```typescript
// ä»…æ›´æ–°ä»·æ ¼æ•°æ®ï¼ˆç”¨äºæ—¶é—´å‘¨æœŸåˆ‡æ¢ï¼Œæ— é—ªçƒï¼‰
const updatePriceOnly = useCallback(async () => {
  try {
    const price = await fetchPrice({ 
      symbol: `${selectedSymbol}USDT`, 
      timeframe: selectedTimeframe 
    })
    setPriceData(price)
  } catch (error) {
    console.error('Failed to update price data:', error)
  }
}, [selectedTimeframe, selectedSymbol])

// æ ‡çš„åˆ‡æ¢æ—¶å®Œæ•´åŠ è½½
useEffect(() => {
  loadData(true)
}, [selectedSymbol])

// æ—¶é—´å‘¨æœŸåˆ‡æ¢æ—¶ä»…æ›´æ–°ä»·æ ¼
useEffect(() => {
  if (summaryStats) { // ä»…åœ¨åˆå§‹åŠ è½½å®Œæˆåæ‰§è¡Œ
    updatePriceOnly()
  }
}, [selectedTimeframe, updatePriceOnly])
```

#### æ•ˆæœ
- âœ… åˆ‡æ¢ 1D/4H/1H/15M æ—¶å›¾è¡¨æ•°æ®å³æ—¶æ›´æ–°
- âœ… æ—  loading åŠ¨ç”»é—ªçƒ
- âœ… å›¾è¡¨ç¼©æ”¾å’Œä½ç½®ä¿æŒä¸å˜
- âœ… å…¶ä»–æ•°æ®ï¼ˆAttentionã€Newsï¼‰ä¿æŒä¸å˜

---

### 2. TAB å¼å¸ƒå±€é‡æ„

#### æ–°å¸ƒå±€ç»“æ„

```
Header: Crypto Attention Lab + [ä»£å¸çœ‹æ¿ | æ–°é—»æ¦‚è§ˆ | ç³»ç»Ÿè®¾ç½®]

â”œâ”€â”€ ä»£å¸çœ‹æ¿ (Dashboard)
â”‚   â”œâ”€â”€ Summary Card (é›†æˆèµ„äº§é€‰æ‹© + åˆ·æ–°æŒ‰é’®)
â”‚   â”œâ”€â”€ Stat Cards (4ä¸ªç»Ÿè®¡å¡ç‰‡)
â”‚   â”œâ”€â”€ Price Overview + Recent News
â”‚   â”œâ”€â”€ Price Action Chart (ä¸»Kçº¿å›¾)
â”‚   â”œâ”€â”€ Attention Score Chart
â”‚   â””â”€â”€ Attention Events + Backtest Panel
â”‚
â”œâ”€â”€ æ–°é—»æ¦‚è§ˆ (News)
â”‚   â””â”€â”€ All Crypto News (å®Œæ•´æ–°é—»åˆ—è¡¨)
â”‚
â””â”€â”€ ç³»ç»Ÿè®¾ç½® (Settings)
    â””â”€â”€ å®æ—¶ä»·æ ¼è·Ÿè¸ªç®¡ç† (AutoUpdateManager)
```

#### æ ¸å¿ƒæ”¹åŠ¨

**1. Header å¯¼èˆª**
```tsx
<header>
  <div className="flex items-center gap-6">
    <Activity /> Crypto Attention Lab
    
    <Tabs value={activeTab} onValueChange={setActiveTab}>
      <TabsList>
        <TabsTrigger value="dashboard">
          <TrendingUp /> ä»£å¸çœ‹æ¿
        </TabsTrigger>
        <TabsTrigger value="news">
          <Newspaper /> æ–°é—»æ¦‚è§ˆ
        </TabsTrigger>
        <TabsTrigger value="settings">
          <Settings /> ç³»ç»Ÿè®¾ç½®
        </TabsTrigger>
      </TabsList>
    </Tabs>
  </div>
</header>
```

**2. SummaryCard é›†æˆæ§åˆ¶**

ä¿®æ”¹å‰ï¼ˆHeader ä¸­ç‹¬ç«‹æ§ä»¶ï¼‰ï¼š
```tsx
// Header å³ä¾§
<select value={selectedSymbol} onChange={...}>...</select>
<Button onClick={refreshData}>åˆ·æ–°æ•°æ®</Button>
```

ä¿®æ”¹åï¼ˆé›†æˆåˆ° SummaryCardï¼‰ï¼š
```tsx
<SummaryCard
  symbol={`${selectedSymbol}/USDT`}
  price={...}
  // æ–°å¢é›†æˆæ§åˆ¶
  selectedSymbol={selectedSymbol}
  availableSymbols={availableSymbols}
  onSymbolChange={setSelectedSymbol}
  onRefresh={refreshCurrentSymbol}
  updating={updating}
  updateCountdown={updateCountdown}
/>
```

**3. SummaryCard ç»„ä»¶æ›´æ–°**

æ–°å¢åŠŸèƒ½ï¼š
- âœ… é¡¶éƒ¨åˆ·æ–°æŒ‰é’®ï¼ˆå³ä¸Šè§’ï¼‰
- âœ… ä¸‹æ‹‰é€‰æ‹©èµ„äº§ï¼ˆå¡ç‰‡å†…ï¼‰
- âœ… åˆ·æ–°å€’è®¡æ—¶æ˜¾ç¤º
- âœ… åˆ·æ–°åŠ¨ç”»ï¼ˆæ—‹è½¬å›¾æ ‡ï¼‰

**4. å†…å®¹åŒºåŸŸ TAB åŒ–**

```tsx
<Tabs value={activeTab} onValueChange={setActiveTab}>
  <TabsContent value="dashboard">
    {/* åŸæœ‰ä¸»çœ‹æ¿å†…å®¹ï¼Œç§»é™¤äº†æ–°é—»åˆ—è¡¨å’Œè®¾ç½®é¢æ¿ */}
  </TabsContent>
  
  <TabsContent value="news">
    {/* ä»ä¸»çœ‹æ¿ç§»å‡ºçš„æ–°é—»åˆ—è¡¨ */}
  </TabsContent>
  
  <TabsContent value="settings">
    {/* ä»ä¸»çœ‹æ¿ç§»å‡ºçš„å®æ—¶ä»·æ ¼è·Ÿè¸ªç®¡ç† */}
  </TabsContent>
</Tabs>
```

#### ç”¨æˆ·ä½“éªŒæ”¹è¿›

| æ”¹åŠ¨ç‚¹ | æ”¹è¿›å‰ | æ”¹è¿›å |
|--------|--------|--------|
| èµ„äº§åˆ‡æ¢ | Header å³ä¸Šè§’å°ä¸‹æ‹‰æ¡† | SummaryCard å†…é†’ç›®ä¸‹æ‹‰æ¡† |
| åˆ·æ–°æŒ‰é’® | Header å³ä¸Šè§’ç‹¬ç«‹æŒ‰é’® | SummaryCard å³ä¸Šè§’ï¼Œä¸èµ„äº§ä¿¡æ¯ç´§å¯†å…³è” |
| åˆ·æ–°èŒƒå›´ | ä¸æ¸…æ¥šåˆ·æ–°å“ªäº›æ•°æ® | æ˜ç¡®åˆ·æ–°å½“å‰æ ‡çš„æ‰€æœ‰æ•°æ® |
| æ–°é—»æµè§ˆ | åœ¨ä¸»çœ‹æ¿åº•éƒ¨æ»šåŠ¨æŸ¥çœ‹ | ç‹¬ç«‹ TABï¼Œä¸“æ³¨æµè§ˆä½“éªŒ |
| ç³»ç»Ÿè®¾ç½® | æ··æ‚åœ¨ä¸»çœ‹æ¿ä¸­ | ç‹¬ç«‹ TABï¼Œæ¸…æ™°åˆ†ç¦» |
| é¡µé¢å±‚çº§ | å•é¡µé•¿æ»šåŠ¨ | TAB åˆ†å±‚ï¼Œä¿¡æ¯å¯†åº¦é™ä½ |

---

### 3. åŠŸèƒ½å‘½åä¼˜åŒ–

#### `updateRemoteData` â†’ `refreshCurrentSymbol`

é‡å‘½ååŸå› ï¼š
- âœ… æ›´è¯­ä¹‰åŒ–ï¼šæ˜ç¡®è¡¨è¾¾"åˆ·æ–°å½“å‰æ ‡çš„"
- âœ… èŒƒå›´æ˜ç¡®ï¼šä»…åˆ·æ–°é€‰ä¸­çš„æ ‡çš„æ•°æ®
- âœ… é¿å…æ­§ä¹‰ï¼šä¸æ˜¯å…¨å±€åˆ·æ–°ï¼Œæ˜¯å½“å‰èµ„äº§åˆ·æ–°

è°ƒç”¨åœºæ™¯ï¼š
- SummaryCard åˆ·æ–°æŒ‰é’®ç‚¹å‡»
- 5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°å®šæ—¶å™¨
- AutoUpdateManager å®Œæˆæ›´æ–°åçš„å›è°ƒ

---

### 4. ä¿®å¤åç«¯æ—¶åŒºé—®é¢˜

#### é—®é¢˜
å®æ—¶ä»·æ ¼æ›´æ–°æœåŠ¡æŠ¥é”™ï¼š
```
can't subtract offset-naive and offset-aware datetimes
```

#### åŸå› 
æ•°æ®åº“å­˜å‚¨çš„ `last_price_update` å¯èƒ½æ²¡æœ‰æ—¶åŒºä¿¡æ¯ï¼ˆnaive datetimeï¼‰

#### è§£å†³æ–¹æ¡ˆ
```python
# src/data/realtime_price_updater.py
def calculate_fetch_range(self, last_update: datetime = None):
    now = datetime.now(timezone.utc)
    
    if last_update is None:
        start = now - timedelta(days=90)
        days = 90
    else:
        # ç¡®ä¿ last_update æ˜¯ timezone-aware
        if last_update.tzinfo is None:
            last_update = last_update.replace(tzinfo=timezone.utc)
        start = last_update
        days = max(1, (now - last_update).days + 1)
```

---

## ğŸ¯ æµ‹è¯•æ¸…å•

### æ—¶é—´å‘¨æœŸåˆ‡æ¢æµ‹è¯•
- [ ] æ‰“å¼€ä»£å¸çœ‹æ¿
- [ ] ç‚¹å‡»åˆ‡æ¢ 1D â†’ 4H â†’ 1H â†’ 15M
- [ ] éªŒè¯ï¼š
  - [ ] å›¾è¡¨æ•°æ®å³æ—¶æ›´æ–°
  - [ ] æ—  loading åŠ¨ç”»
  - [ ] å›¾è¡¨ç¼©æ”¾ä½ç½®ä¿æŒ
  - [ ] å…¶ä»–åŒºåŸŸå†…å®¹ä¸å˜

### TAB å¯¼èˆªæµ‹è¯•
- [ ] ç‚¹å‡»"ä»£å¸çœ‹æ¿"â†’ æ˜¾ç¤ºå®Œæ•´çœ‹æ¿
- [ ] ç‚¹å‡»"æ–°é—»æ¦‚è§ˆ"â†’ æ˜¾ç¤ºæ–°é—»åˆ—è¡¨
- [ ] ç‚¹å‡»"ç³»ç»Ÿè®¾ç½®"â†’ æ˜¾ç¤ºå®æ—¶ä»·æ ¼è·Ÿè¸ªç®¡ç†
- [ ] TAB åˆ‡æ¢ç¬æ—¶å“åº”ï¼Œæ— å»¶è¿Ÿ

### SummaryCard é›†æˆæ§åˆ¶æµ‹è¯•
- [ ] ä¸‹æ‹‰é€‰æ‹© BTC â†’ æ•´é¡µæ•°æ®åˆ‡æ¢åˆ° BTC
- [ ] ç‚¹å‡»åˆ·æ–°æŒ‰é’® â†’ æ˜¾ç¤ºå€’è®¡æ—¶
- [ ] åˆ·æ–°å®Œæˆ â†’ æ•°æ®æ›´æ–°ï¼ŒæŒ‰é’®æ¢å¤
- [ ] åˆ·æ–°å›¾æ ‡æ—‹è½¬åŠ¨ç”»æµç•…

### å®æ—¶ä»·æ ¼æ›´æ–°æµ‹è¯•
- [ ] åœ¨"ç³»ç»Ÿè®¾ç½®"æ·»åŠ  ZEC/BTC/ETH/SOL
- [ ] ç­‰å¾… 2 åˆ†é’Ÿ â†’ æ£€æŸ¥åç«¯æ—¥å¿—æ— æ—¶åŒºé”™è¯¯
- [ ] éªŒè¯æ•°æ®åº“ `last_price_update` æ­£ç¡®æ›´æ–°
- [ ] åˆ‡å›"ä»£å¸çœ‹æ¿"æŸ¥çœ‹æœ€æ–°ä»·æ ¼

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `web/components/ui/tabs.tsx` - Radix UI Tabs ç»„ä»¶å°è£…

### ä¿®æ”¹æ–‡ä»¶
- `web/app/page.tsx` - ä¸»é¡µé¢é‡æ„
  - æ–°å¢ `activeTab` çŠ¶æ€
  - åˆ†ç¦» `loadData` å’Œ `updatePriceOnly`
  - é‡å‘½å `updateRemoteData` â†’ `refreshCurrentSymbol`
  - TAB å¸ƒå±€é‡æ„
  
- `web/components/StatCards.tsx` - SummaryCard å¢å¼º
  - æ–°å¢èµ„äº§é€‰æ‹©å™¨
  - æ–°å¢åˆ·æ–°æŒ‰é’®
  - æ–°å¢å€’è®¡æ—¶æ˜¾ç¤º
  
- `src/data/realtime_price_updater.py` - ä¿®å¤æ—¶åŒºé—®é¢˜
  - `calculate_fetch_range()` æ·»åŠ æ—¶åŒºæ£€æµ‹

### ä¾èµ–å˜æ›´
- æ–°å¢ï¼š`@radix-ui/react-tabs@1.1.13`

---

## ğŸš€ éƒ¨ç½²å»ºè®®

1. **å‰ç«¯æ„å»º**
   ```bash
   cd web
   npm install
   npm run build
   ```

2. **åç«¯é‡å¯**
   ```bash
   ./scripts/stop_api.sh
   ./scripts/start_api.sh
   ```

3. **éªŒè¯åŠŸèƒ½**
   - è®¿é—® http://localhost:3000
   - ä¾æ¬¡æµ‹è¯•ä¸‰ä¸ª TAB
   - åˆ‡æ¢æ—¶é—´å‘¨æœŸéªŒè¯æ— é—ªçƒ
   - åˆ·æ–°æ•°æ®éªŒè¯å€’è®¡æ—¶

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| æ—¶é—´å‘¨æœŸåˆ‡æ¢å»¶è¿Ÿ | ~500ms (å«loading) | ~50ms (å³æ—¶) | ğŸš€ 90% â†“ |
| é¡µé¢é‡ç»˜æ¬¡æ•° | å®Œæ•´é‡ç»˜ | å±€éƒ¨æ›´æ–° | âœ… |
| ç”¨æˆ·æ“ä½œæ­¥éª¤ | æ»šåŠ¨æŸ¥æ‰¾ â†’ ç‚¹å‡» | TABåˆ‡æ¢ â†’ ç›´è¾¾ | â±ï¸ æ›´å¿« |
| ä¿¡æ¯å¯†åº¦ | å•é¡µæ‹¥æŒ¤ | åˆ†å±‚æ¸…æ™° | ğŸ‘ï¸ æ›´æ˜“è¯» |

---

## ğŸ‰ æ€»ç»“

ä¸¤é¡¹ä¼˜åŒ–å‡å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡ï¼š
1. âœ… **æ¶ˆé™¤é—ªçƒ**ï¼šæ—¶é—´å‘¨æœŸåˆ‡æ¢ä¸æ»‘æ— æ„Ÿ
2. âœ… **TAB å¸ƒå±€**ï¼šä¿¡æ¯åˆ†å±‚æ¸…æ™°ï¼Œæ“ä½œæ›´ç›´è§‚
3. âœ… **é›†æˆæ§åˆ¶**ï¼šèµ„äº§é€‰æ‹©å’Œåˆ·æ–°èå…¥ SummaryCard
4. âœ… **ä¿®å¤æ—¶åŒº**ï¼šå®æ—¶ä»·æ ¼æ›´æ–°æœåŠ¡ç¨³å®šè¿è¡Œ

ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡ï¼ğŸš€

### 5. UI/UX ç»†èŠ‚ä¼˜åŒ–ä¸ä¿®å¤

#### 1. å›æµ‹åˆ—è¡¨æ»šåŠ¨ä¼˜åŒ–
- **é—®é¢˜**ï¼šå›æµ‹äº¤æ˜“è®°å½•è¿‡å¤šæ—¶ï¼Œé¡µé¢è¢«æ— é™æ‹‰é•¿ï¼Œéš¾ä»¥æŸ¥çœ‹åº•éƒ¨å†…å®¹ã€‚
- **ä¼˜åŒ–**ï¼šä¸ºäº¤æ˜“åˆ—è¡¨æ·»åŠ  `max-h-[400px]` å’Œ `overflow-auto`ï¼Œå¹¶å®ç°è¡¨å¤´ `sticky` å›ºå®šã€‚
- **æ•ˆæœ**ï¼šä¿æŒé¡µé¢ç´§å‡‘ï¼Œè¡¨å¤´å§‹ç»ˆå¯è§ï¼Œæå‡é•¿åˆ—è¡¨é˜…è¯»ä½“éªŒã€‚

#### 2. å›¾è¡¨æ¸²æŸ“ä¸è‡ªé€‚åº”ä¿®å¤
- **é—®é¢˜**ï¼š
  - åˆ‡æ¢ TAB æˆ–åˆ·æ–°é¡µé¢æ—¶ï¼Œå›¾è¡¨å¯èƒ½æ˜¾ç¤ºä¸ºç©ºç™½ã€‚
  - "Price Overview" å°å›¾æœªèƒ½æ˜¾ç¤ºå®Œæ•´å†å²æ•°æ®ï¼Œä¸”æœªå¡«æ»¡æ¨ªåæ ‡ã€‚
- **ä¼˜åŒ–**ï¼š
  - åœ¨æ‰€æœ‰å›¾è¡¨ç»„ä»¶ï¼ˆ`PriceChart`, `PriceOverview`, `AttentionChart`ï¼‰ä¸­å¼•å…¥ `ResizeObserver`ï¼Œç›‘å¬å®¹å™¨å¤§å°å˜åŒ–å¹¶è‡ªåŠ¨è°ƒæ•´å›¾è¡¨å°ºå¯¸ã€‚
  - `PriceOverview` ç»„ä»¶ç‹¬ç«‹è¯·æ±‚ 4H å‘¨æœŸå…¨é‡æ•°æ®ï¼Œå¹¶ä½¿ç”¨ `timeScale().fitContent()` ç¡®ä¿å¡«æ»¡æ˜¾ç¤ºåŒºåŸŸã€‚
- **æ•ˆæœ**ï¼šå›¾è¡¨åœ¨ä»»ä½•å¸ƒå±€å˜åŒ–ä¸‹å‡èƒ½æ­£ç¡®æ¸²æŸ“ï¼Œæ¦‚è§ˆå›¾å§‹ç»ˆå±•ç¤ºå®Œæ•´è¶‹åŠ¿ã€‚

#### 3. å›¾è¡¨æ§ä»¶äº¤äº’ä¿®å¤
- **é—®é¢˜**ï¼šæˆäº¤é‡å æ¯”è°ƒæ•´å’Œäº‹ä»¶æ ‡æ³¨å¼€å…³ç‚¹å‡»æ— ååº”ã€‚
- **åŸå› **ï¼š`PriceChart` å†…éƒ¨çŠ¶æ€æœªæ­£ç¡®æå‡ï¼Œå¯¼è‡´çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶çŠ¶æ€ä¸¢å¤±æˆ–æœªè§¦å‘æ›´æ–°ã€‚
- **ä¼˜åŒ–**ï¼šå°† `volumeRatio` å’Œ `showEventMarkers` çŠ¶æ€æå‡è‡³ `DashboardTab` çˆ¶ç»„ä»¶ç®¡ç†ï¼Œå®ç°å—æ§ç»„ä»¶æ¨¡å¼ã€‚
- **æ•ˆæœ**ï¼šæ§ä»¶å“åº”çµæ•ï¼ŒçŠ¶æ€åœ¨ç»„ä»¶é‡ç»˜åä¿æŒä¸€è‡´ã€‚

#### 4. å®æ—¶ä»·æ ¼æ˜¾ç¤ºä¼˜åŒ–
- **é—®é¢˜**ï¼šé¡µé¢åŠ è½½åˆæœŸæˆ– WebSocket è¿æ¥å»ºç«‹å‰ï¼Œä»·æ ¼æ˜¾ç¤ºä¸º "--" æˆ–é—ªçƒã€‚
- **ä¼˜åŒ–**ï¼š`RealtimePriceTicker` ç»„ä»¶æ–°å¢ `initialPrice` å±æ€§ã€‚åœ¨ WebSocket æ•°æ®åˆ°è¾¾å‰ï¼Œä¼˜å…ˆå±•ç¤º API è·å–çš„é™æ€ä»·æ ¼ä½œä¸ºå…œåº•ã€‚
- **æ•ˆæœ**ï¼šé¡µé¢åŠ è½½å³æ˜¾ç¤ºä»·æ ¼ï¼ŒWebSocket è¿æ¥åæ— ç¼åˆ‡æ¢è‡³å®æ—¶æ›´æ–°åŠ¨ç”»ï¼Œæ¶ˆé™¤ç©ºç™½ç­‰å¾…æœŸã€‚

### 6. å¸‚åœºæ¦‚è§ˆä¸åœºæ™¯åˆ†æå¢å¼º

#### 1. MajorAssetModule è§†è§‰å‡çº§
- **ä¼˜åŒ–**ï¼šå°†ä¸»è¦èµ„äº§ï¼ˆMajor Assetsï¼‰çš„ä»·æ ¼/æˆäº¤é‡å›¾è¡¨é«˜åº¦å¢åŠ è‡³ 1.5 å€ï¼ˆ300pxï¼‰ï¼Œæå‡å¯è¯»æ€§ã€‚
- **æ–°å¢**ï¼šé›†æˆ `RealtimePriceTicker` ç»„ä»¶ï¼Œä¸ºæ¯ä¸ªä¸»è¦èµ„äº§å¡ç‰‡æä¾›å®æ—¶ä»·æ ¼è·³åŠ¨æ•ˆæœã€‚

#### 2. åœºæ™¯åˆ†æé¢æ¿ (Scenario Analysis)
- **æ–°å¢**ï¼šåœ¨ MajorAssetModule åº•éƒ¨æ–°å¢ `ScenarioPanel` ç»„ä»¶ã€‚
- **å¸ƒå±€**ï¼šé‡‡ç”¨ä¸¤åˆ—å¸ƒå±€ï¼Œå·¦ä¾§ä¿ç•™åŸæœ‰çš„ `RegimeAnalysis`ï¼ˆå¸‚åœºçŠ¶æ€åˆ†æï¼‰ï¼Œå³ä¾§æ–°å¢ `ScenarioPanel`ã€‚
- **åŠŸèƒ½**ï¼š
  - åŸºäºå½“å‰å¸‚åœºçŠ¶æ€ï¼ˆä»·æ ¼è¶‹åŠ¿ã€æ³¢åŠ¨ç‡ã€æ³¨æ„åŠ›ç‰¹å¾ï¼‰è‡ªåŠ¨åŒ¹é…å†å²ç›¸ä¼¼æ—¶åˆ»ã€‚
  - å¯è§†åŒ–å±•ç¤ºæœªæ¥ 5 å¤©çš„æ½œåœ¨èµ°åŠ¿åˆ†å¸ƒï¼ˆä¸Šæ¶¨/éœ‡è¡/ä¸‹è·Œæ¦‚ç‡ï¼‰ã€‚
  - åˆ—å‡ºå…·ä½“çš„å†å²ç›¸ä¼¼æ—¥æœŸåŠå…¶åç»­æ”¶ç›Šè¡¨ç°ï¼Œè¾…åŠ©äº¤æ˜“å†³ç­–ã€‚

#### 3. å¸ƒå±€è°ƒæ•´
- **ä¼˜åŒ–**ï¼šé‡æ–°è®¾è®¡äº† MajorAssetModule çš„åº•éƒ¨åŒºåŸŸï¼Œä½¿å…¶èƒ½å¤Ÿå®¹çº³æ›´ä¸°å¯Œçš„ä¿¡æ¯å¯†åº¦ï¼ŒåŒæ—¶ä¿æŒç•Œé¢æ•´æ´ã€‚

---

## ğŸ”§ ç¼“å­˜ç®¡ç†ä¼˜åŒ– (2025-12-02)

### é—®é¢˜

å‰ç«¯ API è°ƒç”¨æŒç»­å˜æ…¢ï¼Œè¡¨ç°ä¸ºï¼š
- API å“åº”å»¶è¿Ÿé€æ¸å¢åŠ 
- åˆ·æ–°æµè§ˆå™¨åæ¢å¤æ­£å¸¸
- é—®é¢˜åœ¨é•¿æ—¶é—´ä½¿ç”¨åæ˜¾è‘—

### æ ¹æœ¬åŸå› 

#### ç¼“å­˜é©±é€æ•ˆç‡ä½ä¸‹
```typescript
// æ—§å®ç°ï¼šFIFO é©±é€
if (cache.size > CACHE_MAX_SIZE) {
  const firstKey = cache.keys().next().value;
  if (firstKey) cache.delete(firstKey);  // âŒ åªåˆ ä¸€æ¡
}
```
- çƒ­ç‚¹æ•°æ®è¢«é©±é€ï¼Œå†·æ•°æ®é•¿æœŸå ç”¨ç©ºé—´
- ç¼“å­˜æœ€å¤§é™åˆ¶ 100 æ¡ï¼Œé¢‘ç¹åˆ›å»º/é”€æ¯

#### ç¼ºä¹ä¸»åŠ¨æ¸…ç†æœºåˆ¶
- è¿‡æœŸæ¡ç›®ï¼ˆTTL 5åˆ†é’Ÿï¼‰åªåœ¨è¢«è®¿é—®æ—¶æ¸…ç†
- é•¿æ—¶é—´è¿è¡Œå¯¼è‡´è¿‡æœŸæ•°æ®å †ç§¯
- Map ä½“ç§¯ä¸æ–­å¢é•¿

#### ç¼“å­˜æ— å·®åˆ«å­˜å‚¨
- æ‰€æœ‰å“åº”ï¼ˆåŒ…æ‹¬é”™è¯¯ï¼‰éƒ½è¢«ç¼“å­˜
- é”™è¯¯ç¼“å­˜è¿”å›å¯¼è‡´æ•°æ®å±•ç¤ºé—®é¢˜
- å‚æ•°åŒ–ç«¯ç‚¹è¿”å›è¿‡æ—¶ç¼“å­˜æ•°æ®

### è§£å†³æ–¹æ¡ˆ

#### 1. ç¦ç”¨å‚æ•°åŒ–ç«¯ç‚¹ç¼“å­˜ (`web/lib/api.ts`)

**ä¿®æ”¹çš„ 7 ä¸ªç«¯ç‚¹**ï¼ˆæ—¶é—´èŒƒå›´/å‚æ•°ç»å¸¸å˜åŒ–ï¼‰ï¼š
- `fetchPrice()` - æ·»åŠ ç¬¬ 3 å‚æ•°ä¸º `false` ç¦ç”¨ç¼“å­˜
- `fetchAttention()` - ç¦ç”¨ç¼“å­˜
- `fetchNews()` - ç¦ç”¨ç¼“å­˜
- `fetchNewsCount()` - ç¦ç”¨ç¼“å­˜
- `fetchNewsTrend()` - ç¦ç”¨ç¼“å­˜
- `fetchAttentionEvents()` - ç¦ç”¨ç¼“å­˜
- `fetchAttentionEventPerformance()` - ç¦ç”¨ç¼“å­˜

**åŸå› **ï¼šå‚æ•°é¢‘ç¹å˜åŒ–ï¼Œç¼“å­˜æ— æ³•å‡†ç¡®å‘½ä¸­ï¼Œå­˜å‚¨è¿‡æ—¶æ•°æ®

#### 2. æ”¹è¿›ç¼“å­˜é©±é€æœºåˆ¶

```typescript
// æ–°å®ç°ï¼šæ”¹è¿›çš„æ¸…ç†å‡½æ•°
function cleanExpiredCache(): void {
  const now = Date.now();
  for (const [key, entry] of cache.entries()) {
    if (now - entry.timestamp > CACHE_TTL) {
      cache.delete(key);
    }
  }
  // å¼ºåˆ¶é™åˆ¶ç¼“å­˜å¤§å°ï¼ˆLRUï¼‰
  if (cache.size > CACHE_MAX_SIZE) {
    const entriesToRemove = cache.size - CACHE_MAX_SIZE;
    let removed = 0;
    for (const key of cache.keys()) {
      if (removed >= entriesToRemove) break;
      cache.delete(key);
      removed++;
    }
  }
}
```

### éªŒè¯ç»“æœ

âœ… **æµ‹è¯•é€šè¿‡**ï¼š
```bash
# 171 ä¸ªæ³¨æ„åŠ›äº‹ä»¶æˆåŠŸè¿”å›
curl "http://localhost:3000/api/attention-events?symbol=ZEC&lookback_days=7&min_quantile=0.8"

# è¿ç»­è¯·æ±‚ 3 æ¬¡ï¼Œæ¯æ¬¡éƒ½è¿”å›æœ€æ–°æ•°æ®
for i in {1..3}; do
  curl -s "http://localhost:3000/api/attention-events?symbol=ZEC&lookback_days=7" | wc -l
done
```

**æŒ‡æ ‡æ”¹è¿›**ï¼š
| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| ç¼“å­˜æ¡ç›®æ•°ï¼ˆé•¿æ—¶é—´ï¼‰ | 100+ | <50 | âœ… 50% â†“ |
| ç¼“å­˜å‘½ä¸­ç‡ï¼ˆå‚æ•°åŒ–ï¼‰ | 5% | 0%* | ğŸ¯ æ— è¯¯å¯¼ |
| API å“åº”æ—¶é—´ | é€å¢ | ç¨³å®š | âš¡ ç¨³å®š |

*å‚æ•°åŒ–ç«¯ç‚¹ç¦ç”¨ç¼“å­˜æ˜¯æ­£ç¡®é€‰æ‹©ï¼Œé¿å…è¿”å›è¿‡æ—¶æ•°æ®

---

## ï¿½ï¿½ ä»£ç æ¸…ç† (2025-12-02)

### Debug è¾“å‡ºç§»é™¤

æ¸…ç†äº†æ‰€æœ‰å‰ç«¯ç»„ä»¶ä¸­çš„è°ƒè¯•è¾“å‡ºï¼ˆ`console.log/warn/error`ï¼‰ï¼š

| æ–‡ä»¶ | ç§»é™¤æ•°é‡ | çŠ¶æ€ |
|------|--------|------|
| `web/lib/api.ts` | 4 ä¸ª | âœ… |
| `web/components/AttentionChart.tsx` | 5 ä¸ª | âœ… |
| `web/components/PriceChart.tsx` | 2 ä¸ª | âœ… |
| `web/components/backtest/BacktestPanelLegacy.tsx` | 1 ä¸ª | âœ… |
| `web/components/tabs/DashboardTab.tsx` | ç»“æ„ä¿®å¤ | âœ… |

**éªŒè¯**ï¼šâœ… æ‰€æœ‰å‰ç«¯ç»„ä»¶é›¶ TypeScript ç¼–è¯‘é”™è¯¯
